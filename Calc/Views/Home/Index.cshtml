
<h2>Kalkulator</h2>

<div>
    @{
        string[] sex = { "Mężczyzna", "Kobieta" };
    }
    
    
    
    @(Html.DevExtreme().Popup()
          .ID("calc-popup")
          .ElementAttr("class", "popup")
          .Width(300)
          .Height(250)
          .ShowTitle(true)
          .Title("Wynik")
          .Visible(false)
          .DragEnabled(false)
          .CloseOnOutsideClick(true)
          )
    
    @using(Html.DevExtreme().NamedTemplate("popup-template")) {
        <span>
            <div>
                <p align="center" id="result"></p>
            </div>
        </span>
    }

    @(Html.DevExtreme().SelectBox().ID("plecBMI")
                                          .Placeholder("Płeć")
                                          .DataSource(sex)
                                          .Items(i =>
                                      {
                                          i.Add().Text("Mężczyzna");
                                          i.Add().Text("Kobieta");
                                      }))
    <br />
    @(Html.DevExtreme().NumberBox().ID("weightBox").Min(30).Max(300).Placeholder("Masa ciała (kg)").Value(null))
    <br />
    @(Html.DevExtreme().NumberBox().ID("yearsBox").Min(10).Max(100).Placeholder("Wiek (lat)").Value(null))
    <br />
    @(Html.DevExtreme().NumberBox().ID("heightBox").Min(120).Max(250).Placeholder("Wzrost (cm)").Value(null))
    <hr />
    <div class="row"></div>
    <div class="col-xs-6">

        @{
            string[] typeCalc = { "Wskaźnik BMI", "Całkowita przemiana materii", "Masa ciała - normalna wg Broca", "Masa ciała idealna wg Lorenza", "Wskaźnik WHR (Bjoerntorp)", "Wysiłek" };
        }
        @(Html.DevExtreme().SelectBox().ID("calcSelectBox")
                              .Placeholder("Kalkulator")
              .ValueExpr("ID")
              .DisplayExpr("Name")
                              .DataSource(d => d.Mvc().Controller("Home").LoadAction("GetData").Key("ID"))
              .OnValueChanged("tagBox_valueChanged")
        )
    </div>
    <div class="col-xs-6">
        @(Html.DevExtreme().Button().Text("Oblicz").OnClick("OnClickCalculate"))
    </div>

    <hr/>
    @(Html.DevExtreme().Accordion()
                          .ID("accordion-container")
                          .DataSource(d => d.Mvc().Controller("Home").LoadAction("GetData").Key("ID"))
                          .AnimationDuration(300)
                          .Collapsible(false)
                          .Multiple(true)
                          .ItemTitleTemplate(@<text><h1><%= Name %></h1></text>)
                                  .ItemTemplate(@<text>
                                    <div class="accodion-item">
                                        <div>
                                            <p>
                                                <span><%= Description %></span>
                                            </p>
                                        </div>

                                    </div>
                                </text>)
    )
</div>
<script>

    function getAccordionInstance() {
        return $("#accordion-container").dxAccordion("instance");
    }

    function getSeletedBoxValue() {
        return $("#calcSelectBox").dxSelectBox("instance").option("value");
    }

    function getWeightBoxValue() {
        return $("#weightBox").dxNumberBox("instance").option("value");
    }
    function getHeightBoxValue() {
        return $("#heightBox").dxNumberBox("instance").option("value");
    }
    function getYearsBoxValue() {
        return $("#yearsBox").dxNumberBox("instance").option("value");
    }

    function tagBox_valueChanged(e) {
        getAccordionInstance().option("selectedIndex", (e.value-1));
    }

    function OnClickCalculate() {
        var selectedCalc = getSeletedBoxValue();
        if (selectedCalc === 1) {
            CalculateBMI();
        }
        else if (selectedCalc === 3) {
            CalculateCPM();
        }

        NoParameters();
    }


    function NoParameters() {
        $("#result").html('<h3>' + 'Nie wybrano kalkulatora' + '</h3>');
    }

    function CalculateCPM() {
        var sex = getSexBoxValue();
        var weight = getWeightBoxValue();
        var height = getHeightBoxValue();
        var year = getYearsBoxValue();

        //Wzór na PPM dla mężczyzny
        //PPM [kcal] = 88,362 + [13,397 × M (kg)] + [4,799 × W (cm)] – [5,677 × L (lata)]
        //Wzór na PPM dla kobiety
        //PPM [kcal] = 447,593 + [9,247 × M (kg)] + [3,098 × W (cm)] – [4,33 × L (lata)]



        $("#result").html('<h3>' + text + '</h3>');

    }
    function CalculateBMI() {
        OpenPopup();


        var weight = getWeightBoxValue();
        var height = getHeightBoxValue();
        var year = getYearsBoxValue();

        var newHTML = [];
        

        var resultBMI = (weight / ((height/100) * (height/100)));


        if (resultBMI < 16)
            var text = "wygłodzenie";
        else if (resultBMI >= 16 && resultBMI <= 16.99)
            var text = "wychudzenie";
        else if (resultBMI >= 17 && resultBMI <= 18.49)
            var text = "niedowaga";
        else if (resultBMI >= 18.5 && resultBMI <= 24.99)
            var text = "waga prawidłowa";
        else if (resultBMI >= 25 && resultBMI <= 29.99)
            var text = "nadwaga";
        else if (resultBMI >= 30 && resultBMI <= 34.99)
            var text = "I stopień otyłości";
        else if (resultBMI >= 35 && resultBMI <= 39.99)
            var text = "II stopień otyłości";
        else if (resultBMI > 40)
            var text = "otyłość skrajna";

            $("#result").html('<h3>'+text+'</h3>');
    }

    function OpenPopup() {
        var popup = $("#calc-popup").dxPopup("instance");
        popup.option("contentTemplate", $("#popup-template"));
        popup.show();
    }




</script>